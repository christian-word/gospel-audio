<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Gospel Player (–°—É–º—ã ¬© 2025)</title>
  <meta property="og:image" content="https://raw.githubusercontent.com/christian-word/gospel-audio/main/GPlayer.jpg" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      scrollbar-width: thin;
    }
    
    :root {
      --primary-color: #1db954;
      --primary-glow: rgba(29, 185, 84, 0.1);
    }
    
    * {
      scrollbar-color: var(--primary-color) #202020;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: #121212;
      color: #fff;
      height: 100vh;
      width: 100%;
      overflow-x: hidden;
      touch-action: manipulation;
      transition: all 0.3s ease;
    }
    .app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100%;
      overflow-x: hidden;
    }
    .header {
      background: #000;
      padding: 16px;
      border-bottom: 1px solid #282828;
      position: sticky;
      top: 0;
      z-index: 10;
      width: 100%;
    }
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-color);
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .subtitle {
      font-size: 12px;
      color: #b3b3b3;
      margin-top: 4px;
    }
    .search-container {
      position: relative;
      flex: 1;
      margin-left: 16px;
    }
    .search-input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      background: #242424;
      border: 1px solid #404040;
      border-radius: 24px;
      color: #fff;
      font-size: 14px;
      outline: none;
    }
    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
      font-size: 16px;
    }
    .playlist-container {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 80px;
    }
    .track-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #282828;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .track-item:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    .track-item.active {
      background-color: var(--primary-color);
      color: #000;
    }
    .track-item.active .track-name,
    .track-item.active .track-number {
      color: #000 !important;
    }
    .track-icon {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
    }
    .track-info {
      flex: 1;
      margin-left: 12px;
      overflow: hidden;
    }
    .track-name {
      font-size: 16px;
      font-weight: 500;
      color: #fff;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .track-number {
      font-size: 14px;
      color: #b3b3b3;
    }
    .player-controls {
      background: #000;
      border-top: 1px solid #282828;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      z-index: 10;
      width: 100%;
    }
    .current-track-info {
      display: flex;
      align-items: center;
      flex: 1;
      min-width: 0;
    }
    .current-track-thumb {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
    }
    .current-track-details {
      margin-left: 12px;
      overflow: hidden;
    }
    .current-track-details h4 {
      font-size: 16px;
      font-weight: 500;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .current-track-details p {
      font-size: 14px;
      color: #b3b3b3;
    }
    .playback-controls {
      display: flex;
      align-items: center;
      margin-left: 16px;
    }
    .control-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      font-size: 24px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
    }
    .control-btn:hover {
      color: var(--primary-color);
    }
    .play-btn {
      background: var(--primary-color);
      color: #fff !important;
      font-size: 20px;
      margin: 0 8px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
      font-family: inherit;
      line-height: 1;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .progress-container {
      position: absolute;
      top: -4px;
      left: 0;
      right: 0;
      height: 4px;
      background: #282828;
    }
    .progress-bar {
      height: 100%;
      background: var(--primary-color);
      width: 0%;
      transition: background-color 0.3s ease;
    }
    .visual-section {
      display: none;
    }
    @media (min-width: 768px) {
      .app { flex-direction: row; }
      .playlist-container {
        width: 33.33%;
        border-right: 1px solid #282828;
        padding-bottom: 0;
      }
      .visual-section {
        display: flex;
        width: 66.66%;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 32px;
        background: radial-gradient(circle at 30% 30%, var(--primary-glow) 0%, transparent 80%);
        position: relative;
        transition: background 0.3s ease;
      }
      .player-controls {
        border-top: none;
        border-left: 1px solid #282828;
      }
      .progress-container { top: 0; }
    }
    .settings-panel {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .settings-content {
      background: #181818;
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      padding: 24px;
      color: #fff;
      max-width: 90%;
      width: 300px;
      box-shadow: 0 0 24px rgba(0,0,0,0.5);
      text-align: center;
    }
    .settings-content h2 {
      margin-bottom: 16px;
      font-size: 20px;
      color: var(--primary-color);
      transition: color 0.3s ease;
    }
    .settings-panel.hidden { display: none; }
    .settings-content button {
      margin-top: 20px;
      padding: 8px 16px;
      background: var(--primary-color);
      border: none;
      color: #000;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .settings-content select {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #404040;
      background: #242424;
      color: #fff;
      width: 100%;
    }
    
    /* –¶–≤–µ—Ç–æ–≤—ã–µ —Ç–µ–º—ã */
    .theme-green {
      --primary-color: #1db954;
      --primary-glow: rgba(29, 185, 84, 0.1);
    }
    
    .theme-blue {
      --primary-color: #1e90ff;
      --primary-glow: rgba(30, 144, 255, 0.1);
    }
    
    .theme-purple {
      --primary-color: #9b59b6;
      --primary-glow: rgba(155, 89, 182, 0.1);
    }
  </style>
</head>
<body class="theme-green">
  <div class="app">
    <div class="playlist-container">
      <div class="header">
        <div class="header-content">
          <div>
            <div class="logo">Gospel Player  ‚öôÔ∏è</div>
            <div class="subtitle">–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞ (–°—É–º—ã ¬© 2025)</div>
          </div>
          <div class="search-container">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤..." oninput="searchTrack(this.value)" />
          </div>
        </div>
      </div>
      <div id="playlist"></div>
    </div>
    <div class="visual-section">
      <img id="cover" src="https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png" alt="–û–±–ª–æ–∂–∫–∞">
      <div id="track-title" class="visual-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫</div>
    </div>
  </div>

  <div class="player-controls">
    <div class="progress-container">
      <input type="range" id="seekbar" value="0" min="0" step="1" style="width: 100%; appearance: none; height: 4px; background: transparent; position: absolute; top: 0; left: 0; right: 0; z-index: 5; cursor: pointer;">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="current-track-info">
      <img class="current-track-thumb" id="current-thumb" src="https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png" />
      <div class="current-track-details">
        <h4 id="current-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</h4>
        <p id="current-artist">–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞</p>
      </div>
    </div>
    <div class="playback-controls">
      <button class="control-btn" onclick="prevTrack()">‚èÆ</button>
      <button class="control-btn play-btn" onclick="togglePlay()" id="play-btn">‚ñ∂</button>
      <button class="control-btn" onclick="nextTrack()">‚è≠</button>
    </div>
  </div>

  <div id="settings-panel" class="settings-panel hidden">
    <div class="settings-content">
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <label>–í—ã–±–æ—Ä –ø–ª–µ–π–ª–∏—Å—Ç–∞:
        <select id="setting-playlist">
          <option>–ó–∞–≥—Ä—É–∑–∫–∞...</option>
        </select>
      </label><br><br>
      <button onclick="applySettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button onclick="closeSettings()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <audio id="audio" preload="auto"></audio>
  <script>
    const defaultPlaylist = "https://raw.githubusercontent.com/christian-word/GospelVoice/refs/heads/main/playlist/generated-playlist2.json";
    const saved = localStorage.getItem("gospelPlayerPlaylist");
    const playlistUrl = saved || defaultPlaylist;
    let playlist = [];
    let currentIndex = 0;
    let audio = document.getElementById("audio");
    let searchText = "";
    let isSeeking = false;
    const seekbar = document.getElementById("seekbar");

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ü–≤–µ—Ç–æ–≤–æ–π —Ç–µ–º—ã
    function setColorTheme(playlistIndex) {
      const body = document.body;
      body.classList.remove('theme-green', 'theme-blue', 'theme-purple');
      
      if (playlistIndex === 0) {
        body.classList.add('theme-green');
      } else if (playlistIndex === 1) {
        body.classList.add('theme-blue');
      } else if (playlistIndex === 2) {
        body.classList.add('theme-purple');
      } else {
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∏–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        body.classList.add('theme-blue');
      }
    }

    // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
    const playlistCache = new Map();
    
    async function loadPlaylist() {
      try {
        showLoadingState(true);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        if (playlistCache.has(playlistUrl)) {
          const data = playlistCache.get(playlistUrl);
          playlist = data.playlist || [];
        } else {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
          const data = await fetchWithRetry(playlistUrl);
          playlist = data.playlist || [];
          playlistCache.set(playlistUrl, data);
        }
        
        const saved = localStorage.getItem("gospelPlayerIndex");
        if (saved && playlist[saved]) currentIndex = parseInt(saved);
        renderPlaylist();
        loadTrack(currentIndex);
        showLoadingState(false);
      } catch (error) {
        showError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.");
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞:", error);
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    async function fetchWithRetry(url, maxRetries = 3, delay = 1000) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
          
          const response = await fetch(url, { 
            signal: controller.signal,
            cache: 'default' // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫—ç—à
          });
          clearTimeout(timeoutId);
          
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return await response.json();
        } catch (error) {
          if (i === maxRetries - 1) throw error;
          await new Promise(resolve => setTimeout(resolve, delay * (i + 1)));
        }
      }
    }

    function renderPlaylist() {
      const list = document.getElementById("playlist");
      list.innerHTML = "";
      playlist.forEach((track, i) => {
        if (!filterTrack(i)) return;
        const div = document.createElement("div");
        div.className = "track-item";
        if (i === currentIndex) {
          div.classList.add("active");
          setTimeout(() => div.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
        }
        div.innerHTML = `
          <img class="track-icon" src="${track.image || 'https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png'}" />
          <div class="track-info">
            <div class="track-name">${track.title}</div>
            <div class="track-number">#${i + 1} ‚Ä¢ ${track.group || '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'}</div>
          </div>`;
        div.onclick = () => {
          currentIndex = i;
          loadTrack(i);
          audio.play();
          updatePlayButton();
        };
        list.appendChild(div);
      });
    }

    function loadTrack(index) {
      if (!playlist[index]) return;
      const track = playlist[index];
      
      // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç—Ä–µ–∫–∞
      preloadNextTrack(index);
      
      document.getElementById("track-title").textContent = `${index + 1}. ${track.title}`;
      
      // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å fallback
      loadImageOptimized(track.image, "cover");
      loadImageOptimized(track.image, "current-thumb");
      
      document.getElementById("current-title").textContent = `${track.title}`;
      document.getElementById("current-artist").textContent = track.group || "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞";
      
      // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      if (audio.src !== track.url) {
        audio.src = track.url;
        audio.preload = navigator.connection && navigator.connection.effectiveType === '2g' ? 'metadata' : 'auto';
        audio.load();
      }
      
      localStorage.setItem("gospelPlayerIndex", index);
      currentIndex = index;
      renderPlaylist();
      updatePlayButton();
    }
    
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç—Ä–µ–∫–∞ –¥–ª—è –±–µ—Å—à–æ–≤–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    let preloadAudio = null;
    function preloadNextTrack(currentIndex) {
      const nextIndex = getNextTrackIndex(currentIndex);
      if (nextIndex !== -1 && playlist[nextIndex]) {
        if (!preloadAudio) preloadAudio = new Audio();
        preloadAudio.src = playlist[nextIndex].url;
        preloadAudio.preload = 'metadata';
      }
    }
    
    function getNextTrackIndex(currentIndex) {
      for (let i = currentIndex + 1; i < playlist.length; i++) {
        if (filterTrack(i)) return i;
      }
      return -1;
    }
    
    // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    function loadImageOptimized(src, elementId) {
      const element = document.getElementById(elementId);
      const defaultImage = "https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png";
      
      if (!src || src === defaultImage) {
        element.src = defaultImage;
        return;
      }
      
      const img = new Image();
      img.onload = () => element.src = src;
      img.onerror = () => element.src = defaultImage;
      img.src = src;
    }

    function togglePlay() {
      if (audio.paused) audio.play(); else audio.pause();
      updatePlayButton();
    }

    function updatePlayButton() {
      document.getElementById("play-btn").textContent = audio.paused ? "‚ñ∂" : "‚ùö‚ùö";
    }

    function nextTrack() {
      const nextIndex = getNextTrackIndex(currentIndex);
      if (nextIndex !== -1) {
        currentIndex = nextIndex;
        loadTrack(nextIndex);
        audio.play().catch(handlePlayError);
      }
    }

    function prevTrack() {
      for (let i = currentIndex - 1; i >= 0; i--) {
        if (filterTrack(i)) {
          currentIndex = i;
          loadTrack(i);
          audio.play().catch(handlePlayError);
          return;
        }
      }
    }
    
    function togglePlay() {
      if (audio.paused) {
        audio.play().catch(handlePlayError);
      } else {
        audio.pause();
      }
      updatePlayButton();
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
    function handlePlayError(error) {
      console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", error);
      showError("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ç—Ä–µ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π.");
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ç—Ä–µ–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ
      setTimeout(() => {
        const nextIndex = getNextTrackIndex(currentIndex);
        if (nextIndex !== -1) {
          currentIndex = nextIndex;
          loadTrack(nextIndex);
          audio.play().catch(() => showError("–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ."));
        }
      }, 2000);
    }
    
    // –ü–æ–∫–∞–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    function showLoadingState(isLoading) {
      const playlist = document.getElementById("playlist");
      if (isLoading) {
        playlist.innerHTML = '<div style="padding: 20px; text-align: center; color: #b3b3b3;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞...</div>';
      }
    }
    
    // –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    function showError(message) {
      // –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 1001;
        background: #e74c3c; color: white; padding: 12px 20px;
        border-radius: 8px; font-size: 14px; max-width: 300px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transform: translateX(100%); transition: transform 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
      setTimeout(() => notification.style.transform = 'translateX(0)', 100);
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 4000);
    }

    function searchTrack(query) {
      searchText = query.toLowerCase();
      for (let i = 0; i < playlist.length; i++) {
        const t = playlist[i].title.toLowerCase();
        const g = (playlist[i].group || "").toLowerCase();
        if (t.includes(searchText) || g.includes(searchText) || ("" + (i + 1)) === searchText.trim()) {
          loadTrack(i); break;
        }
      }
      renderPlaylist();
    }

    function filterTrack(index) {
      if (!searchText) return true;
      const t = playlist[index].title.toLowerCase();
      const g = (playlist[index].group || "").toLowerCase();
      return t.includes(searchText) || g.includes(searchText) || ("" + (index + 1)) === searchText.trim();
    }

    audio.onended = nextTrack;
    audio.ontimeupdate = () => {
      if (!isSeeking && audio.duration) {
        const progress = audio.currentTime / audio.duration;
        document.getElementById("progress-bar").style.width = (progress * 100) + "%";
        seekbar.max = audio.duration;
        seekbar.value = audio.currentTime;
      }
    };
    seekbar.oninput = () => { isSeeking = true; };
    seekbar.onchange = () => { audio.currentTime = seekbar.value; isSeeking = false; };
    audio.onplay = updatePlayButton;
    audio.onpause = updatePlayButton;
    loadPlaylist();

    // –ù–ê–°–¢–†–û–ô–ö–ò
    const playlistListUrl = "https://www.dl.dropboxusercontent.com/scl/fi/4wn3hvg8646xm7z3glatj/playlists.json?rlkey=dvngzq4grm31gmp79b9ji6ce6&st=es1fq47j";
    let allPlaylists = [];
    function openSettings() {
      document.getElementById("settings-panel").classList.remove("hidden");
    }
    function closeSettings() {
      document.getElementById("settings-panel").classList.add("hidden");
    }
    function applySettings() {
      const playlistUrl = document.getElementById("setting-playlist").value;
      const selectedIndex = document.getElementById("setting-playlist").selectedIndex;
      
      localStorage.setItem("gospelPlayerPlaylist", playlistUrl);
      localStorage.setItem("gospelPlayerTheme", selectedIndex);
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–æ–≤—É—é —Ç–µ–º—É —Å—Ä–∞–∑—É
      setColorTheme(selectedIndex);
      
      closeSettings();
      alert("–ü–ª–µ–π–ª–∏—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.");
    }
    function loadSettingsUI() {
      loadPlaylistList();
    }
    async function loadPlaylistList() {
      try {
        const res = await fetch(playlistListUrl);
        const data = await res.json();
        allPlaylists = data;
        populatePlaylistDropdown();
      } catch (e) {
        console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤:", e);
      }
    }
    function populatePlaylistDropdown() {
      const select = document.getElementById("setting-playlist");
      select.innerHTML = "";
      allPlaylists.forEach((p, index) => {
        const option = document.createElement("option");
        option.value = p.url;
        option.textContent = p.title;
        select.appendChild(option);
      });
      const saved = localStorage.getItem("gospelPlayerPlaylist");
      if (saved) select.value = saved;
    }
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    function loadSavedTheme() {
      const savedTheme = localStorage.getItem("gospelPlayerTheme");
      if (savedTheme !== null) {
        setColorTheme(parseInt(savedTheme));
      } else {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—É –ø–æ —Ç–µ–∫—É—â–µ–º—É –ø–ª–µ–π–ª–∏—Å—Ç—É
        const saved = localStorage.getItem("gospelPlayerPlaylist");
        if (saved && allPlaylists.length > 0) {
          const currentIndex = allPlaylists.findIndex(p => p.url === saved);
          if (currentIndex !== -1) {
            setColorTheme(currentIndex);
          }
        }
      }
    }
    
    document.addEventListener("DOMContentLoaded", () => {
      const logo = document.querySelector(".logo");
      if (logo) {
        logo.addEventListener("dblclick", () => {
          loadSettingsUI();
          openSettings();
        });
      }
      
      // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
      setTimeout(loadSavedTheme, 500);
    });
  </script>
</body>
</html>
