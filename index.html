<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Gospel Player+1010 —Ç—Ä–µ–∫–æ–≤</title>
  <!-- –ó–∞—Å—Ç–∞–≤–∫–∞-->
  <meta property="og:image" content="https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/unnam.png" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #121212;
      color: #fff;
      height: 100vh;
      width: 100%;
      overflow-x: hidden;
      touch-action: manipulation;
    }

    .app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100%;
      overflow-x: hidden;
    }

    .header {
      background: #000;
      padding: 16px;
      border-bottom: 1px solid #282828;
      position: sticky;
      top: 0;
      z-index: 10;
      width: 100%;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 20px;
      font-weight: 700;
      color: #1db954;
    }

    .subtitle {
      font-size: 12px;
      color: #b3b3b3;
      margin-top: 4px;
    }

    .search-container {
      position: relative;
      flex: 1;
      margin-left: 16px;
    }

    .search-input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      background: #242424;
      border: 1px solid #404040;
      border-radius: 24px;
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-input:focus {
      border-color: #1db954;
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #b3b3b3;
      font-size: 16px;
    }

    .playlist-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding-bottom: 80px;
      width: 100%;
      scrollbar-width: thin;
      scrollbar-color: #1db954 #282828;
    }

    .playlist-container::-webkit-scrollbar {
      width: 6px;
    }

    .playlist-container::-webkit-scrollbar-track {
      background: #282828;
    }

    .playlist-container::-webkit-scrollbar-thumb {
      background-color: #1db954;
      border-radius: 3px;
    }

    .track-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #282828;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .track-item:hover {
      background-color: #282828;
    }

    .track-item.active {
      background: #1db954;
    }

    .track-item.active .track-name,
    .track-item.active .track-number {
      color: #000;
    }

    .track-icon {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
      transition: transform 0.2s;
    }

    .track-item:hover .track-icon {
      transform: scale(1.05);
    }

    .track-info {
      flex: 1;
      margin-left: 12px;
      overflow: hidden;
    }

    .track-name {
      font-size: 16px;
      font-weight: 500;
      color: #fff;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track-number {
      font-size: 14px;
      color: #b3b3b3;
    }

    .player-controls {
      background: #000;
      border-top: 1px solid #282828;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      z-index: 10;
      width: 100%;
    }

    .current-track-info {
      display: flex;
      align-items: center;
      flex: 1;
      min-width: 0;
    }

    .current-track-thumb {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .current-track-details {
      margin-left: 12px;
      overflow: hidden;
    }

    .current-track-details h4 {
      font-size: 16px;
      font-weight: 500;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .current-track-details p {
      font-size: 14px;
      color: #b3b3b3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .playback-controls {
      display: flex;
      align-items: center;
      margin-left: 16px;
    }

    .control-btn {
      background: none;
      border: none;
      color: #b3b3b3;
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s, transform 0.1s;
    }

    .control-btn:active {
      transform: scale(0.9);
    }

    .control-btn:hover {
      color: #fff;
    }

    .play-btn {
      background: #1db954;
      color: #000;
      font-size: 20px;
      margin: 0 8px;
      border-radius: 50%;
      transition: transform 0.2s;
    }

    .play-btn:hover {
      transform: scale(1.05);
      color: #000;
    }

    .progress-container {
      position: absolute;
      top: -4px;
      left: 0;
      right: 0;
      height: 4px;
      background: #282828;
    }

    .progress-bar {
      height: 100%;
      background: #1db954;
      width: 0%;
      transition: width 0.1s;
    }

    .loading {
      padding: 16px;
      text-align: center;
      color: #b3b3b3;
    }

    .empty-state {
      padding: 32px 16px;
      text-align: center;
      color: #b3b3b3;
    }

    /* –°–∫—Ä—ã–≤–∞–µ–º visual-section –≤ –º–æ–±–∏–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ */
    .visual-section {
      display: none;
    }

    @media (min-width: 768px) {
      .app {
        flex-direction: row;
      }

      .playlist-container {
        width: 33.33%;
        border-right: 1px solid #282828;
        padding-bottom: 0;
      }

      /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º visual-section —Ç–æ–ª—å–∫–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–∞—Ö */
      .visual-section {
        display: flex;
        width: 66.66%;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 32px;
        background: radial-gradient(circle at 30% 30%, rgba(29, 185, 84, 0.1) 0%, transparent 80%);
        position: relative;
      }

      .visual-section img {
        max-width: 80%;
        max-height: 400px;
        object-fit: cover;
        border-radius: 16px;
        box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4);
        margin-bottom: 24px;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .visual-section img:hover {
        transform: scale(1.02);
        box-shadow: 0 32px 64px rgba(0, 0, 0, 0.5);
      }

      .visual-title {
        font-size: 24px;
        font-weight: 600;
        color: #fff;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 80%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .player-controls {
        position: relative;
        border-top: none;
        border-left: 1px solid #282828;
      }

      .progress-container {
        top: 0;
      }
    }
@keyframes zoomGlow {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 0 10px rgba(29, 185, 84, 0.3);
  }
  50% {
    transform: scale(1.03);
    box-shadow: 0 0 20px rgba(29, 185, 84, 0.7);
  }
}

.playing #visual-cover {
  animation: zoomGlow 5s ease-in-out infinite;
  border-radius: 12px;
}
  </style>
</head>
<body>
  <div class="app">
    <div class="playlist-container" id="playlist">
      <div class="header">
        <div class="header-content">
          <div>
            <div class="logo">Gospel Player</div>
            <div class="subtitle">–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞ (–°—É–º—ã ¬© 2025)</div>
          </div>
          <div class="search-container">
            <span class="search-icon">üîç</span>
            <input type="text" class="search-input" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤..." />
          </div>
        </div>
      </div>
      <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞...</div>
    </div>
    <div class="visual-section" id="visual-section">
      <img id="visual-cover" class="visual-cover" src="https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png" alt="–û–±–ª–æ–∂–∫–∞ —Ç—Ä–µ–∫–∞">
      <div class="visual-title" id="visual-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫</div>
    </div>
  </div>
  <div class="player-controls">
    <div class="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="current-track-info">
      <img class="current-track-thumb" id="current-thumb" src="https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png" />
      <div class="current-track-details">
        <h4 id="current-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫</h4>
        <p id="current-artist">–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞</p>
      </div>
    </div>
    <div class="playback-controls">
      <button class="control-btn" onclick="prevTrack()" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫">‚èÆ</button>
      <button class="control-btn play-btn" onclick="togglePlay()" id="play-btn" title="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">‚ñ∂</button>
      <button class="control-btn" onclick="nextTrack()" title="–°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫">‚è≠</button>
    </div>
  </div>
  <audio id="audio" preload="auto"></audio>
<script>
const playlistUrl = "https://raw.githubusercontent.com/christian-word/GospelVoice/refs/heads/main/playlist/generated-playlist2.json";
let playlist = [];
let currentIndex = 0;
let searchText = "";
const audio = document.getElementById("audio");
let updateProgressInterval;

async function loadPlaylist() {
  try {
    const res = await fetch(playlistUrl);
    const data = await res.json();
    playlist = data.playlist || [];

    const savedIndex = localStorage.getItem("gospelPlayerIndex");
    if (savedIndex && playlist[savedIndex]) {
      currentIndex = parseInt(savedIndex);
    }

    renderPlaylist();
    loadTrack(currentIndex);
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", err);
    document.querySelector(".loading").textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞";
  }
}

function renderPlaylist() {
  const list = document.getElementById("playlist");
  const loadingElement = list.querySelector(".loading");
  if (loadingElement) loadingElement.remove();

  const container = list.querySelector(".tracks-container") || document.createElement("div");
  container.className = "tracks-container";
  
  const filtered = playlist
    .map((track, i) => ({ track, index: i }))
    .filter(({ index }) => filterTrack(index));

  if (filtered.length === 0) {
    const emptyState = document.createElement("div");
    emptyState.className = "empty-state";
    emptyState.textContent = "–¢—Ä–µ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã";
    list.appendChild(emptyState);
    return;
  }

  container.innerHTML = filtered.map(({ track, index }) => {
    const isActive = index === currentIndex;
    const img = track.image || "https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png";
    return `
      <div class="track-item ${isActive ? 'active' : ''}" onclick="selectTrack(${index})" data-index="${index}">
        <img class="track-icon" src="${img}" alt="${track.title}" loading="lazy">
        <div class="track-info">
          <div class="track-name">${track.title}</div>
          <div class="track-number">#${index + 1}${track.group ? ` ‚Ä¢ ${track.group}` : ''}</div>
        </div>
      </div>
    `;
  }).join('');

  if (!list.contains(container)) {
    list.appendChild(container);
  }

  const activeItem = container.querySelector(`.track-item[data-index="${currentIndex}"]`);
  if (activeItem) {
    activeItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

function filterTrack(index) {
  if (!searchText) return true;
  const track = playlist[index];
  const searchLower = searchText.toLowerCase();
  const title = track.title.toLowerCase();
  const artist = track.artist ? track.artist.toLowerCase() : '';
  const number = (index + 1).toString();
  
  return title.includes(searchLower) || 
         artist.includes(searchLower) || 
         number === searchText.trim();
}

function selectTrack(index) {
  if (index < 0 || index >= playlist.length) return;

  currentIndex = index;
  loadTrack(index);
  audio.play().catch(e => console.warn("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏:", e));
}

function loadTrack(index) {
  const track = playlist[index];
  if (!track) return;

  const image = track.image || "https://raw.githubusercontent.com/ruyriy/Audio-christ/main/ICO/church_image.png";

  document.getElementById("current-title").textContent = track.title;
  document.getElementById("current-artist").textContent = track.artist || "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –º—É–∑—ã–∫–∞";
  document.getElementById("current-thumb").src = image;
  document.getElementById("visual-cover").src = image;
  document.getElementById("visual-title").textContent = track.title;

  audio.src = track.url;
  audio.load();
  
  document.getElementById("progress-bar").style.width = "0%";
  localStorage.setItem("gospelPlayerIndex", index);
  renderPlaylist();
  updatePlayButton();
}

function togglePlay() {
  if (audio.paused) {
    audio.play().catch(e => console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", e));
  } else {
    audio.pause();
  }
  updatePlayButton();
}

function updatePlayButton() {
  const playBtn = document.getElementById("play-btn");
  playBtn.textContent = audio.paused ? "‚ñ∂" : "‚è∏";
  playBtn.title = audio.paused ? "–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏" : "–ü–∞—É–∑–∞";
}

function nextTrack() {
  let nextIndex = currentIndex + 1;
  while (nextIndex < playlist.length) {
    if (filterTrack(nextIndex)) {
      selectTrack(nextIndex);
      return;
    }
    nextIndex++;
  }
  nextIndex = 0;
  while (nextIndex < currentIndex) {
    if (filterTrack(nextIndex)) {
      selectTrack(nextIndex);
      return;
    }
    nextIndex++;
  }
}

function prevTrack() {
  let prevIndex = currentIndex - 1;
  while (prevIndex >= 0) {
    if (filterTrack(prevIndex)) {
      selectTrack(prevIndex);
      return;
    }
    prevIndex--;
  }
  prevIndex = playlist.length - 1;
  while (prevIndex > currentIndex) {
    if (filterTrack(prevIndex)) {
      selectTrack(prevIndex);
      return;
    }
    prevIndex--;
  }
}

function searchTrack(query) {
  searchText = query.trim().toLowerCase();
  renderPlaylist();
}

function startProgressUpdate() {
  stopProgressUpdate();
  updateProgress();
  updateProgressInterval = setInterval(updateProgress, 1000);
}

function stopProgressUpdate() {
  if (updateProgressInterval) {
    clearInterval(updateProgressInterval);
    updateProgressInterval = null;
  }
}

function updateProgress() {
  if (audio.duration) {
    const progress = (audio.currentTime / audio.duration) * 100;
    document.getElementById("progress-bar").style.width = `${progress}%`;
  }
}

function handleProgressClick(e) {
  if (!audio.duration) return;
  
  const progressContainer = document.querySelector(".progress-container");
  const rect = progressContainer.getBoundingClientRect();
  const clickPosition = e.clientX - rect.left;
  const progressPercentage = (clickPosition / rect.width) * 100;
  
  audio.currentTime = (progressPercentage / 100) * audio.duration;
  document.getElementById("progress-bar").style.width = `${progressPercentage}%`;
}

document.getElementById("search-input").addEventListener("input", e => searchTrack(e.target.value));
document.querySelector(".progress-container").addEventListener("click", handleProgressClick);

audio.addEventListener("ended", () => {
  nextTrack();
});

audio.addEventListener("play", () => {
  updatePlayButton();
  startProgressUpdate();
  document.getElementById("visual-section").classList.add("playing");
});

audio.addEventListener("pause", () => {
  updatePlayButton();
  stopProgressUpdate();
  document.getElementById("visual-section").classList.remove("playing");
});

audio.addEventListener("timeupdate", updateProgress);

document.addEventListener("keydown", (e) => {
  switch(e.code) {
    case "Space":
      e.preventDefault();
      togglePlay();
      break;
    case "ArrowRight":
      nextTrack();
      break;
    case "ArrowLeft":
      prevTrack();
      break;
  }
});

loadPlaylist();
</script>

</body>
</html>
